# Design: signet

*Version 1 — Auto-maintained by pact*

## Decomposition

- [C] **Root** (`root`)
  # Signet: Personal Sovereign Agent Stack

Build a personal data sovereignty system where the user's encrypted vault is the cryptographic root of trust, a personal agent acts as steward carrying proofs
  - [ ] **Signet Credential Engine** (`signet_cred`)
    Self-issuance credential engine. Takes structured data from vault and produces credentials in two formats: (1) SD-JWT VC per RFC 9901 using sd-jwt-rust (OpenWallet Foundation) for baseline interoperability, and (2) BBS+ signed attribute sets using anoncreds-v2-rs for unlinkable presentations. Pre-computes boolean attributes (age_over_21, balance_above_1000, etc.) in BBS+ credentials to avoid ZK circuits. Generates Pedersen commitments for numeric attributes (for downstream Bulletproof range proofs). TTL management with expiry tracking. One-time credential consumption tracking. Credentials signed by vault's identity key. Credential storage and caching within vault.
  - [ ] **Signet MCP Server** (`signet_mcp`)
    MCP (Model Context Protocol) server bridging personal AI agent to the vault ecosystem. Authenticates personal agent via Ed25519 session keys (expiring, revocable). OAuth 2.1 with PKCE for initial agent setup/provisioning. Exposes five MCP tools: signet_get_proof (request a proof for an external service), signet_query (query vault data within tier constraints), signet_request_capability (request a PASETO v4 capability token), signet_negotiate_context (negotiate disclosure scope with external agent), signet_check_status (check pending request status). Routes every request through policy engine. Enforces tier logic: Tier 1 auto-serve proofs, Tier 2 decrypt for agent but enforce conclusions-only egress (raw data never transmitted to external services), Tier 3 suspend request and delegate to notification channel. Session management with expiry and revocation. Runs as local process or self-hosted server. All disclosures recorded to audit log.
  - [ ] **Signet Notification Channel** (`signet_notify`)
    Webhook-based authorization channel for Tier 3 requests and ANOMALY escalations. Presents structured reasoning payload: who is asking, what they want, why it is unusual, what options the user has. Accepts user response: approve, deny, or modify (with scope adjustment). Timeout defaults to deny (fail-secure). Sub-second delivery target for webhooks. Implements webhook delivery with retry logic, HMAC signature verification for callback authenticity. Response propagation back to the suspended policy decision. SMS and push channels are out of scope for v1.
  - [ ] **Signet Policy Engine** (`signet_policy`)
    Policy evaluation engine. Every data request evaluated as Actor + Predicate + Context = Legitimacy. Three-way decision output: PERMIT, DENY, ANOMALY. Role hierarchy: Public < Commerce < Financial < Medical < Identity < Trusted Agent. Actor classification via four methods: explicit assignment, credential-based, domain inference, or self-declaration. ANOMALY decisions trigger escalation with structured reasoning (who, what, why unusual, options) — never silently resolved. Pattern tracker: records user approve/deny decisions per actor+predicate pair, auto-suggests policy rules based on frequency patterns (simple counter/threshold, not ML). Policies stored in vault as structured JSON. Fail-secure: pipeline timeout defaults to deny.
  - [ ] **Signet Proof Workshop** (`signet_proof`)
    Proof derivation engine operating on cached credentials. Implements: SD-JWT selective disclosure presentations, BBS+ unlinkable proofs (fresh nonce per presentation for unlinkability), Bulletproof range proofs from Pedersen commitments using dalek bulletproofs (nightly). All proofs are domain-bound (relying party origin/DID + timestamp/nonce) and time-limited. Proof composition: combine multiple proofs into a single presentation. Performance SLAs: <20ms for SD-JWT and BBS+ derivation, <200ms for Bulletproof range proofs. BBS+ unlinkability invariant must be statistically tested.
  - [C] **Signet Developer SDK** (`signet_sdk`)
    Developer-facing SDK for external service integration. Four primitives: verify(proof, claim) — verify a Signet proof against a claimed attribute, requestCapability(spec) — request a scoped capability from a Signet MCP server, checkAuthority(signet_id) — check if a Signet identity has a given authority, parseCredential(token) — parse and validate an SD-JWT or BBS+ credential. Rust primary crate with zero transitive dependencies beyond crypto (aws-lc-rs, sd-jwt-rust, anoncreds-v2-rs). TypeScript bindings via wasm-bindgen/wasm-pack. Python bindings via PyO3. 10-line integration target for passive verification. Verification is self-contained and does not require vault access.
  - [C] **Signet Vault** (`signet_vault`)
    Encrypted local data store with key management. Implements: BIP39 mnemonic generation and recovery, SLIP-0010 Ed25519 master key derivation, HKDF-based key hierarchy (Ed25519 identity, X25519 encryption, per-device keys, Tier 3 compartment keys). Envelope encryption using aws-lc-rs (Ed25519 + X25519 + AES-256-GCM). Three-tier data model: Tier 1 (public-ish, agent-accessible), Tier 2 (sensitive, agent-accessible but conclusions-only egress enforced upstream), Tier 3 (restricted, compartment keys structurally inaccessible to agent). Content-addressed blob storage. Encrypted client-side index. Append-only hash-chained audit log (each entry includes hash of previous entry, write-path isolated from agent sessions). Per-device key provisioning via existing-device ceremony. Compile-time feature flags for SQLite+filesystem (self-hosted) vs Postgres+S3 (multi-tenant). Storage trait abstraction with two backends. User-assignable tier classification with sensible defaults. Zero secrets in memory after use.
